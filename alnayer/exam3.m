% f'=th
% th"+((la+5)/2)fth'-((2la+1)/2)f'th=0
% la=1,2,3;
% f(0)=0
% th'(0)=-1 , th(inf)=0
clear all
clc
N=100;
[D,x]=chep(N);
L=10;
scale =2/L;
I=eye(N+1);
%-------------------------------------------------------------
D1=scale*D;
D2=(scale^2*D^2);
y=L*(x+1)/2;
%-------------------------------------------------------------
f00=y;f01=D1*y;
F00=f00;F01=f01;
%-------------------------------------------------------------
th00=y.*exp(-y)+exp(-y);
th01=D1*th00;th02=D2*th00;
TH00=th00;TH01=th01;TH02=th02;
%-------------------------------------------------------------
ite=10;
for la=1:3;
    disp('______________________________________________________________')
disp('     i     la   F00(N+1)     F01(N+1)     TH00(N+1)     TH01(N+1)')
disp('___________________________________________________________________')

for i=1:ite
   
A11=D1;
A12=-I;
A21=-((2*la+1)/3)*diag(TH00)*D1+((la+5)/2)*diag(TH01);
A22=D2+((la+5)/2)*diag(F00)*D1-((2*la+1)/3)*diag(F01);
R1=TH00-F01;
R2=-(TH02+((la+5)/2)*F00.*TH01-((2*la+1)/3)*F01.*TH00);
   
%-----------------------------------------------------------------
A11(N+1,:)=0;A11(N+1,N+1)=1;A12(N+1,:)=0;R1(N+1)=0;
%-----------------------------------------------------------
A22(1,:)=0;A22(1,1)=1;A21(1,:)=0;R2(1)=0;
A22(N+1,:)=D1(N+1,:);A21(N+1,:)=0;R2(N+1)=0;
%----------------------------------------------------------------
A=[A11 A12;A21 A22];
R=[R1;R2];
sol=A\R;
%--------------------------------------------------------------
Fm=sol(1:N+1);
F00=F00+Fm;
F01=D1*F00;
%-----------------------------------------------------------------
THm=sol(N+2:2*N+2);
TH00=THm+TH00;
TH01=D1*TH00;
TH02=D2*TH00;
%-----------------------------------------------------------------
fprintf('%5.0f\t %5.0f\t %0.7f\t %0.7f\t  %0.7f\t %0.7f\n',i,la,F00(N+1),F01(N+1),TH00(N+1),TH01(N+1))
end

figure(1)
plot(y,F00)
hold on
figure(2)
plot(y,TH00)
hold on
end