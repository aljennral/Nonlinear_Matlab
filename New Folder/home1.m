clear all 
clc
N=100;
L=20;
I=eye(N+1);
[D,x]=cheb(N);
scale =2/L;
D1=scale*D;
D2=(scale^2*D^2);
D3=(scale^3*D^3);
y=L*(x+1)/2;
%_______________ ________________ ___________ ______________ _____________
h00=y.*exp(-y)+exp(-y)-1;
h01=D1*h00;
h02=D2*h00;
h03=D3*h00;
H00=h00;
H01=h01;
H02=h02;
H03=h03;
g00=exp(-y);
g01=D1*g00;
g02=D2*g00;
G00=g00;
G01=g01;
G02=g02;
%______________________________________________________________________
iter=20;
for i=1:iter
    A11=D3-diag(H00)*D2+diag(H00)*D-diag(H02)*I;
    A12=-4*diag(G00);
    R1=-(H03-H00.*H02+0.5*H01.^2-2*G00.^2);
    A11(N+1,:)=0;A11(N+1,N+1)=1;A12(N+1,:)=0;R1(N+1)=0;
    A11(1,:)=D1(1,:);R1(1)=0;A12(1,:)=0;
    A11(N,:)=D1(N+1,:);R1(N)=0;A12(N,:)=0;
    %____________________________________________________________________
    A21=diag(G00)*D1-diag(G01)*I;
    A22=D2-diag(H00)*D1+diag(H01)*I;
    R2=-(G02-H00.*G01+H01.*G00);
    A21(1,:)=0;A22(1,:)=0;A22(1,1)=1;R2(1)=0;
    A21(N+1,:)=0;A22(N+1,:)=0;A22(N+1,N+1)=1;R2(N+1)=0;
    %__________________________________________________________________
    A=[A11,A12;A21,A22];
    R=[R1;R2];
    sol=R\A;
HS=sol(1:N+1);
GS=sol(N+2:2*N+2);
%-------------------------------------------------------------------%
H00=H00+HS;
H01=D1*H00;
H02=D1*H01;
H03=D1*H02;
%-------------------------------------------------------------------%
G00=G00+GS;
G01=D1*G00;
G02=D1*G01;
fprintf('%10.0f\t %0.5f\t %0.5f\n',i,G01(N+1),H02(N+1));
end