% f"'+05ff"=0
% th"+05prfth'=0
% f(0)=f'(0)=0
%f'(inf)=1
%th(0)=0
%th(inf)=1

clear all
clc
N=100;
[D,x]=chep(N);
L=20;
pr=0.7;
scale =2/L;
%-------------------------------------------------------------
D1=scale*D;
D2=(scale^2*D^2);
D3=(scale^3*D^3);
y=L*(x+1)/2;
%-------------------------------------------------------------
f00=-y.*exp(-y)-exp(-y)+1;
f01=D1*f00;
f02=D2*f00;
f03=D3*f00;
%-------------------------------------------------------------
th00=-exp(-y)+1;
th01=D1*th00;
th02=D1*th01;
%------------------------------------------------------------
F00=f00;F01=f01;F02=f02;F03=f03;
TH00=th00;TH01=th01;TH02=th02;
ite=20;
%------------------------------------------------------------
disp('_______________________________________________________________')
disp('     i    F00(N+1)   F01(N+1)   TH00(N+1)    TH01(N+1)')
disp('_______________________________________________________________')

for i=1:ite
    A11=D3+0.5*diag(F00)*D2+0.5*diag(F02);
    A12=zeros(N+1,N+1);
    A21=0.5*pr*diag(TH01);
    A22=D2+0.5*pr*diag(F00)*D1;
    R1=-(F03+0.5*F00.*F02);
    R2=-(TH02+0.5*pr*F00.*TH01);
    %---------------------------------------------------------
    A11(N+1,:)=0;A11(N+1,N+1)=1;R1(N+1)=0;
     A11(N,:)=D1(N+1,:);R1(N)=0;
     A11(1,:)=D1(1,:);R1(1)=0;
     %--------------------------------------------------------
     A22(1,:)=0;A22(1,1)=1;A21(1,:)=0;R2(1)=0;
     A22(N+1,:)=0;A22(N+1,N+1)=1;A21(N+1,:)=0;R2(N+1)=0;
%-------------------------------------------------------------
A=[A11 A12;A21 A22];
R=[R1;R2];
sol=A\R;
%--------------------------------------------------------------
Fm=sol(1:N+1);
F00=F00+Fm;
F01=D1*F00;
F02=D2*F00;
F03=D3*F00;
%-----------------------------------------------------------------
THm=sol(N+2:2*N+2);
TH00=THm+TH00;
TH01=D1*TH00;
TH02=D2*TH00;
%-----------------------------------------------------------------
fprintf('%10.0f\t %0.8f\t %0.8f\t %0.8f\t %0.8f\n',i,F00(N+1),F01(N+1),TH00(N+1),TH01(N+1))
end
figure(1)
plot(y,f00)
figure(2)
plot(y,TH00)
